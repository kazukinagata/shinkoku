---
name: assess
description: >
  This skill should be used when the user asks to determine what tax filings
  they need, wants to know if they must file a tax return (確定申告), asks about
  consumption tax obligations (消費税), or needs help understanding their filing
  requirements. Trigger phrases include: "確定申告が必要か", "申告の種類",
  "消費税の届出", "課税事業者かどうか", "何を申告すればいい", "申告要否",
  "税金の申告", "住民税の申告".
---

# 申告要否・種類の判定（Tax Filing Assessment）

確定申告が必要かどうか、どの種類の申告が必要かを対話的に判定するスキル。
ユーザーの収入状況・家族構成・事業状況をヒアリングし、必要な申告を特定する。

## 設定の読み込み（最初に実行）

1. `shinkoku.config.yaml` を Read ツールで読み込む
2. ファイルが存在しない場合は `/setup` スキルの実行を案内して終了する
3. 設定値を把握し、相対パスは CWD を基準に絶対パスに変換する:
   - `db_path`: MCP ツールの `db_path` 引数に使用
   - `output_dir`: PDF 生成時の `output_path` 引数のベースディレクトリに使用
   - 各ディレクトリ: ファイル参照時に使用

## 進捗情報の読み込み

設定の読み込み後、引継書ファイルを読み込んで前ステップの結果を把握する。

1. `.shinkoku/progress/progress-summary.md` を Read ツールで読み込む（存在する場合）
2. 以下の引継書を Read ツールで読み込む（存在する場合）:
   - `.shinkoku/progress/01-setup.md`
3. 読み込んだ情報を以降のステップで活用する（ユーザーへの再質問を避ける）
4. ファイルが存在しない場合はスキップし、ユーザーに必要情報を直接確認する

## 判定の基本方針

- ユーザーが「収入」で話す場合、内部的に「所得」に変換して判定を行う
- 判定は所得税 → 消費税 → 住民税の順序で実施する
- 各判定で根拠となる条文・通達を示す
- 判定結果は最後にサマリーとして一覧提示する
- 不明な点がある場合は追加質問で確認する（推測で判定しない）

### ヒアリング時の質問設計ルール

- チェックリストの項目は**すべて漏れなく確認する**こと。ツールの選択肢数制限（AskUserQuestionは1問あたり最大4選択肢）のために項目を省略してはならない。項目数が多い場合は**複数回に分けて**確認する
- 1つの事象に複数の側面がある場合（例: 中古住宅を購入してリフォームも実施）は、**複数選択可能（multiSelect: true）**にするか、組み合わせパターンを選択肢に含める
- 選択肢を設計する前に、その項目が**排他的（1つだけ選ぶ）か並立的（複数該当しうる）か**を判断する

## ステップ1: 基本情報ヒアリング

以下の情報を対話で収集する。一度にすべてを聞かず、自然な会話の流れで段階的に確認する。

### 1-0. 前年の確定申告の確認

事業所得がある場合（開業2年目以降）、前年の確定申告内容を確認する。
config の `past_returns_dir` にファイルがあれば参照する。

#### 確認項目

- [ ] 前年の確定申告書（第一表）の有無
- [ ] 前年の事業所得金額（黒字 or 赤字）
- [ ] 前年の申告納税額（㊺欄）— 15万円を超えていたか
- [ ] 予定納税の有無と納付済み金額（第1期・第2期）
- [ ] 純損失の繰越控除の有無（前年以前に青色申告で赤字を出したか）
- [ ] 前年の消費税の課税売上高（基準期間の判定に使用）

#### 予定納税の判定ルール（所得税法第104条）

前年の申告納税額（㊺欄）が **15万円以上** の場合:
- 第1期（7月）: 前年納税額の1/3
- 第2期（11月）: 前年納税額の1/3
- 残りは確定申告で精算

予定納税を納付済みの場合、確定申告書 ㊹欄「源泉徴収税額」に加算する。

#### 純損失の繰越控除（所得税法第70条）

前年以前3年以内に青色申告で純損失がある場合:
- 繰越控除可能額を確認する
- 当年の所得から控除できる

### 1-1. 給与収入の確認

- 給与収入の有無と概算金額
- 給与の支払元の数（1か所 or 複数）
- 年末調整の実施有無
- 源泉徴収票の有無

### 1-2. 給与以外の収入の確認

以下の収入の有無を**すべて**順に確認する（項目数が多い場合は複数回に分けること）:

- 事業収入（副業・フリーランス）→ 概算金額、開業届の有無、青色申告承認の有無
- 不動産収入
- 株式・配当収入（特定口座/一般口座/NISA）
- 雑所得（暗号資産、FX、年金等）
- 一時所得（保険満期金、懸賞金等）
- 譲渡所得（不動産売却、ゴルフ会員権等）
- 退職所得

### 1-3. 控除関連の確認

以下の項目を**すべて**確認する。項目数が多いため、2回に分けて確認すること。

#### グループA: 大型控除（確定申告の要否に直結する項目）

- 住宅ローン控除（初年度 or 2年目以降）★申告要否に影響
- 医療費の支払い（10万円超の目安）
- ふるさと納税の有無と金額（ワンストップ特例の利用状況）

#### グループB: その他の控除

- iDeCo・小規模企業共済の加入
- 生命保険・地震保険の加入
- 扶養家族の有無

### 1-4. 住宅取得の詳細確認（住宅ローン控除が該当する場合）

住宅の取得・リフォームが判明した場合、以下を追加で確認する。

#### 取得の種類（複数該当しうるため、multiSelectで確認する）

- 新築住宅の取得
- 中古住宅（既存住宅）の取得
- 増改築・リフォーム

※「中古住宅を購入してリフォームも実施」はよくあるパターンのため、必ず複数選択を許可すること。
  中古取得+リフォームの場合、それぞれで住宅ローン控除の借入限度額が異なる可能性がある。

#### 確認すべき詳細情報

- 取得価格（土地・建物の内訳がわかれば）
- リフォーム費用（該当する場合）
- 住宅ローンの有無と年末残高の見込み
- 入居日（取得後6か月以内に入居したか）
- 床面積（50㎡以上か。所得1,000万円以下なら40㎡以上）
- 中古の場合: 建築年（昭和57年/1982年以降か = 新耐震基準）
- 省エネ性能区分（認定長期優良住宅・ZEH・省エネ基準適合・その他）

→ 詳細な控除額の判定は skills/tax-advisor/reference/housing-loan.md を参照

### ヒアリング完了チェックリスト

**ステップ2の判定に進む前に、以下のすべてを確認済みであること。未確認の項目があればユーザーに追加質問する。**

#### 収入関連
- [ ] 給与収入の有無・金額・支払元の数
- [ ] 年末調整の実施有無
- [ ] 事業収入（副業・フリーランス）の有無
- [ ] 不動産収入の有無
- [ ] 株式・配当収入の有無
- [ ] 雑所得（暗号資産・FX・年金等）の有無
- [ ] 一時所得の有無
- [ ] 譲渡所得の有無
- [ ] 退職所得の有無

#### 控除関連
- [ ] 住宅ローン控除の該当有無（初年度 or 2年目以降）
- [ ] 医療費の支払い状況
- [ ] ふるさと納税の有無
- [ ] iDeCo・小規模企業共済の加入有無
- [ ] 生命保険・地震保険の加入有無
- [ ] 扶養家族の有無

#### 前年確定申告関連
- [ ] 前年の申告納税額（予定納税の要否判定）
- [ ] 予定納税の有無・納付済み金額
- [ ] 純損失の繰越の有無

## ステップ2: 所得税の確定申告の要否判定

収集した情報に基づき、以下のフローチャートで判定する。

### 判定フローチャート: 確定申告が必要なケース

```
Q1. 給与所得者ですか？
├── Yes → Q2へ
└── No → Q5へ

Q2. 給与収入は2,000万円を超えますか？
├── Yes → 【確定申告必要】（所得税法第121条第1項）
└── No → Q3へ

Q3. 給与を2か所以上から受けていますか？
├── Yes → 主たる給与以外の収入が20万円を超えるか確認 → Q4へ
└── No → Q4へ

Q4. 給与所得・退職所得以外の所得が20万円を超えますか？
├── Yes → 【確定申告必要】（所得税法第121条第1項第2号）
└── No → Q6へ

Q5. 事業所得・不動産所得等がありますか？
├── Yes → 所得金額が基礎控除+所得控除の合計を超えるか？
│   ├── Yes → 【確定申告必要】
│   └── No → 【確定申告不要】（ただし損失繰越のために申告する場合あり）
└── No → 各所得の合計で判定

Q6. 以下のいずれかに該当しますか？
- 医療費控除を受けたい
- ふるさと納税でワンストップ特例を使わない/使えない
- 住宅ローン控除の初年度
- 雑損控除を受けたい
- 年末調整で申告漏れした控除がある
├── Yes → 【確定申告した方が有利（還付申告）】
└── No → 【確定申告不要】
```

### 確定申告が不要なケース（確認的提示）

以下に該当する場合は確定申告不要であることを明示する:

- 給与所得者で年末調整済み、かつ副業所得20万円以下（ただし住民税申告は必要）
- 公的年金等の収入が400万円以下で、年金以外の所得が20万円以下
- 所得が基礎控除額以下

### 注意: 20万円以下でも申告が必要なケース

副業所得20万円以下で所得税の確定申告が不要でも、以下の場合は申告が必要:

- 住民税の申告は別途必要（市区町村への申告）
- 医療費控除等で確定申告する場合は20万円以下の所得も合算必須
- ふるさと納税のワンストップ特例は確定申告すると無効になる

## ステップ3: 消費税の申告要否判定

### 判定フローチャート: 消費税の課税事業者判定

```
Q1. 事業収入（売上）がありますか？
├── No → 【消費税申告不要】
└── Yes → Q2へ

Q2. 基準期間（2年前: 令和5年）の課税売上高が1,000万円を超えますか？
├── Yes → 【課税事業者】→ 消費税申告必要
└── No → Q3へ

Q3. 特定期間（前年1-6月: 令和6年1-6月）の課税売上高または
    給与支払額が1,000万円を超えますか？
├── Yes → 【課税事業者】→ 消費税申告必要
└── No → Q4へ

Q4. 適格請求書発行事業者（インボイス登録）をしていますか？
├── Yes → 【課税事業者（インボイス登録による）】→ 消費税申告必要
│         → 2割特例の適用可否を確認（令和8年9月30日までの経過措置）
└── No → 【免税事業者】→ 消費税申告不要
```

### 消費税の申告方法の判定

課税事業者と判定された場合、以下の申告方法を判定する:

```
Q1. 2割特例の適用要件を満たすか？
    （インボイス登録により課税事業者になった者で、基準期間の課税売上が1,000万円以下）
├── Yes → 2割特例が最も有利な場合が多い。簡易課税・本則課税との比較を提案
└── No → Q2へ

Q2. 基準期間の課税売上高が5,000万円以下で、簡易課税の届出をしているか？
├── Yes → 簡易課税で申告
└── No → 本則課税で申告
```

## ステップ4: 住民税の申告要否判定

### 判定フローチャート

```
Q1. 確定申告を行いますか？
├── Yes → 住民税の申告は不要（確定申告データが市区町村に送付される）
└── No → Q2へ

Q2. 給与所得のみで年末調整済みですか？
├── Yes → Q3へ
└── No → 【住民税の申告が必要】

Q3. 給与以外の所得がありますか？（20万円以下を含む）
├── Yes → 【住民税の申告が必要】（所得税では不要でも住民税は必要）
└── No → 住民税の申告は不要（給与支払報告書が提出されている）
```

### 住民税の徴収方法の確認

副業がある給与所得者には以下を確認する:

- 普通徴収（自分で納付）: 副業を会社に知られたくない場合
- 特別徴収（給与天引き）: デフォルト
- 確定申告書の「住民税に関する事項」で選択可能

## ステップ5: 判定結果サマリーの提示

すべての判定が完了したら、以下の形式で結果をまとめて提示する:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
申告要否・種類の判定結果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

■ 所得税の確定申告: [必要 / 不要 / 還付申告推奨]
  根拠: [該当条文・理由]

■ 消費税の申告: [必要 / 不要]
  課税事業者区分: [課税事業者 / 免税事業者]
  申告方法: [2割特例 / 簡易課税 / 本則課税]

■ 住民税の申告: [不要（確定申告で対応） / 別途必要]

■ 次のステップ:
  → gather スキルで必要書類を確認する
  → [その他の推奨アクション]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 引継書の出力

サマリー提示後、以下のファイルを Write ツールで出力する。
これにより、セッションの中断や Compact が発生しても次のステップで結果を引き継げる。

### ステップ別ファイルの出力

`.shinkoku/progress/02-assess.md` に以下の形式で出力する:

```
---
step: 2
skill: assess
status: completed
completed_at: "{当日日付 YYYY-MM-DD}"
fiscal_year: {tax_year}
---

# 申告要否・種類の判定結果

## 判定結果

- 所得税の確定申告: {必要/不要/還付申告推奨}（{根拠}）
- 消費税の申告: {必要/不要}
- 住民税の申告: {不要（確定申告で対応）/別途必要}
- 青色申告特別控除: {65万円/10万円}（{根拠}）

## 収入の概要

- 給与収入: {あり/なし}（{詳細}）
- 事業収入: {あり/なし}（{詳細}）
- その他の収入: {該当する収入があれば記載}

## 予定納税

- 前年の申告納税額（㊺欄）: {金額}円
- 予定納税額: {金額}円（第1期・第2期 各{金額}円、{納付済み/未納付}）

## 純損失の繰越控除

- 繰越控除の有無: {あり/なし}
- 繰越損失額: {金額}円（{損失発生年度}）

## 消費税の詳細

- 課税事業者区分: {課税事業者/免税事業者}（{根拠}）
- 基準期間の課税売上高: {金額}万円
- 適用可能な方法: {2割特例/簡易課税/本則課税}

## 次のステップ

/gather で必要書類を確認する
```

### 進捗サマリーの更新

`.shinkoku/progress/progress-summary.md` を更新する（存在しない場合は新規作成）:

- YAML frontmatter: fiscal_year、last_updated（当日日付）、current_step: assess
- テーブル: 全ステップの状態を更新（assess を completed に）
- 次のステップの案内を記載

### 出力後の案内

ファイルを出力したらユーザーに以下を伝える:
- 「引継書を `.shinkoku/progress/` に保存しました。セッションが中断しても次のスキルで結果を引き継げます。」
- 次のステップの案内

## 特殊ケースへの対応

### 年の途中で退職した場合

- 年末調整が未実施 → 確定申告で精算が必要
- 退職金がある場合 → 退職所得の源泉徴収票を確認

### 海外関連

- 海外居住者（非居住者）の場合は対象外であることを明示
- 外国税額控除の適用可能性を確認

### 災害等の特例

- 災害による雑損控除・災害減免法の適用可能性を確認

## 免責事項の提示

判定結果の提示時に以下を必ず付記する:

- この判定は一般的な基準に基づくものであり、個別の事情によって異なる場合がある
- 最終的な判断は税理士等の専門家に確認することを推奨する
- 参照: skills/tax-advisor/reference/disclaimer.md
