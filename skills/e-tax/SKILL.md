---
name: e-tax
description: >
  This skill should be used when the user wants to file their tax return
  electronically via the 確定申告書等作成コーナー (NTA Tax Return Preparation
  Corner) using Claude in Chrome. It guides the browser-based input of
  calculated tax data. Trigger phrases include: "e-Tax提出", "電子申告",
  "e-Taxで申告", "作成コーナーに入力", "確定申告書等作成コーナー",
  "作成コーナー", "申告書を提出".
---

# e-Tax 電子申告 — Claude in Chrome による確定申告書等作成コーナー入力

shinkoku で計算した確定申告データを、確定申告書等作成コーナー（https://www.keisan.nta.go.jp/）に
Claude in Chrome を使ってブラウザ上で入力・提出するためのスキル。

## 前提条件

- `/income-tax` スキルで所得税の計算が完了していること
- `/settlement` スキルで決算書（PL/BS）の作成が完了していること
- `/consumption-tax` スキルで消費税の計算が完了していること（該当者のみ）
- `shinkoku.config.yaml` が設定済みであること
- **Claude in Chrome 拡張機能**がインストール済みであること

## 設定の読み込み（最初に実行）

1. `shinkoku.config.yaml` を Read ツールで読み込む
2. ファイルが存在しない場合は `/setup` スキルの実行を案内して終了する
3. 設定値を把握する:
   - 納税者プロファイル（氏名・住所・マイナンバー等）
   - 事業情報（屋号・業種等）
   - 申告方法（e-Tax/郵送/窓口）

## 進捗情報の読み込み

1. `.shinkoku/progress/progress-summary.md` を Read ツールで読み込む（存在する場合）
2. 以下の引継書を Read ツールで読み込む（存在する場合）:
   - `.shinkoku/progress/06-settlement.md` — 決算結果（PL/BS データ）
   - `.shinkoku/progress/07-income-tax.md` — 所得税計算結果
   - `.shinkoku/progress/08-consumption-tax.md` — 消費税計算結果
   - `.shinkoku/progress/02-assess.md` — 課税判定結果
3. 計算結果がまだ存在しない場合は、先に `/income-tax` や `/settlement` の実行を案内する

## ステップ0: 必須データの検証

確定申告書等作成コーナーへの入力に必要なデータが揃っているか検証する。

### 検証項目

```
[1] 税額計算済み
    - .shinkoku/progress/07-income-tax.md が存在し、status: completed であること

[2] プロファイル完備
    - 氏名（姓・名）が登録されているか
    - 住所が登録されているか
    - 所轄税務署名が登録されているか

[3] 決算書データ
    - PL/BS の計算結果が取得可能であること

[4] 消費税（該当者のみ）
    - .shinkoku/progress/08-consumption-tax.md が存在し、status: completed であること

[5] サニティチェック
    - `tax_calc.py sanity-check` を実行する
    - error > 0 の場合: 入力を中止し、`/income-tax` スキルで修正を促す
    - warning > 0 の場合: ユーザーに確認してから続行する
```

## ステップ1: 確定申告書等作成コーナーへのアクセス

ユーザーに以下の手順を案内する:

1. Chrome で確定申告書等作成コーナーにアクセス:
   **https://www.keisan.nta.go.jp/**
2. 「作成開始」をクリック
3. 提出方法を選択:
   - **e-Tax（マイナンバーカード方式）**: マイナンバーカード + スマホ/ICカードリーダー
   - **e-Tax（ID・パスワード方式）**: 利用者識別番号 + 暗証番号
   - **書面**: 印刷して郵送/持参
4. 税務署の情報を入力（config から自動提案）

## ステップ2: 所得税の申告書入力

Claude in Chrome が各画面のフォームに値を入力する。入力値は shinkoku の計算結果から取得する。

### 入力フロー概要

1. **収入金額の入力**
   - 給与所得: 源泉徴収票の情報
   - 事業所得: 青色申告決算書の売上金額
   - 雑所得: 仮想通貨・副業等の収入

2. **青色申告決算書の入力**（事業所得がある場合）
   - 損益計算書（PL）: 売上・経費の各科目
   - 貸借対照表（BS）: 資産・負債・純資産
   - 減価償却明細

3. **所得控除の入力**
   - 社会保険料控除
   - 生命保険料控除（新旧・3区分）
   - 地震保険料控除
   - 小規模企業共済等掛金控除（iDeCo 等）
   - 医療費控除
   - 寄附金控除（ふるさと納税含む）
   - 配偶者控除/特別控除
   - 扶養控除
   - 基礎控除

4. **税額控除の入力**
   - 住宅ローン控除（該当者のみ）
   - 配当控除（該当者のみ）

5. **その他の入力**
   - 源泉徴収税額
   - 予定納税額
   - 還付口座情報

### 各画面での入力指示

Claude in Chrome への入力指示は以下の形式で行う:

```
画面: [画面名]
入力フィールド:
  - [フィールド名]: [値]（引継書の [項目名] から取得）
  - [フィールド名]: [値]
操作: [次へ] ボタンをクリック
```

**重要: 各画面で入力後、ユーザーに値の確認を求める。確認なしに「次へ」は進めない。**

## ステップ3: 消費税の申告書入力（該当者のみ）

消費税の課税事業者の場合、所得税の申告書とは別に消費税申告書を入力する。

### 入力項目

- 申告方法（2割特例/簡易課税/本則課税）
- 課税売上高（税率区分別）
- 課税仕入高（本則課税の場合）
- 中間納付税額

## ステップ4: 申告内容の確認

作成コーナーの確認画面で、shinkoku の計算結果と一致しているか検証する。

### 検証項目

```
□ 合計所得金額が一致するか
□ 所得控除合計が一致するか
□ 課税所得金額が一致するか
□ 算出税額が一致するか
□ 税額控除が一致するか
□ 復興特別所得税が一致するか
□ 申告納税額（または還付額）が一致するか
□ 消費税の納付税額が一致するか（該当者のみ）
```

不一致がある場合は、差異の原因を調査し、ユーザーに報告する。

## ステップ5: 電子署名と送信

1. マイナンバーカードで電子署名する（ユーザーの手動操作）
2. 送信完了後、受付番号を控える
3. メッセージボックスで受信通知を確認する

### 注意事項

- 電子署名はマイナンバーカードの署名用パスワード（6〜16桁の英数字）が必要
- 送信後の修正は「修正申告」として再提出が必要

## ステップ6: .data ファイルの保存案内

作成コーナーでは申告データを `.data` ファイルとして保存できる。
ユーザーに以下を案内する:

- 送信前に「入力データを保存する」で `.data` ファイルをダウンロードする
- `.data` ファイルがあれば、次回は「保存データを利用して作成」から途中再開できる
- 控えとしても有用（来年の申告時に前年データとして参照可能）

## 引継書の出力

全ステップ完了後、以下のファイルを Write ツールで出力する。

### ステップ別ファイルの出力

`.shinkoku/progress/10-etax.md` に以下の形式で出力する:

```
---
step: 10
skill: e-tax
status: completed
completed_at: "{当日日付 YYYY-MM-DD}"
fiscal_year: {tax_year}
---

# e-Tax 電子申告の結果

## 提出方法

- 確定申告書等作成コーナー（Claude in Chrome 入力代行）

## 税額サマリー

- 事業所得: {金額}円
- 課税所得: {金額}円
- 所得税額: {金額}円
- 申告納税額: {金額}円（{納付/還付}）
- 消費税納付額: {金額}円（該当者のみ）

## 送信結果

- 受付番号: {受付番号}
- 送信日時: {日時}

## 次のステップ

/submit で提出後のチェックリストを確認する
```

### 進捗サマリーの更新

`.shinkoku/progress/progress-summary.md` を更新する（存在しない場合は新規作成）:

- YAML frontmatter: fiscal_year、last_updated（当日日付）、current_step: e-tax
- テーブル: 全ステップの状態を更新（e-tax を completed に）

## 免責事項

- 確定申告書等作成コーナーの画面構成・フォーム要素は国税庁の更新により変更される可能性がある
- Claude in Chrome の入力代行はユーザーの目視確認を前提とする — 自動送信は行わない
- マイナンバーカードの操作（電子署名）はユーザーの手動操作が必要
- 最終的な申告内容は税理士等の専門家に確認することを推奨する
